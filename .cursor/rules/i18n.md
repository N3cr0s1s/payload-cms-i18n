---
title: Internationalization (i18n)
description: Localization patterns for Payload CMS with next-intl
tags: [payload, i18n, localization, next-intl, routing]
---

# Internationalization (i18n)

This project uses a dual i18n approach:
1. **Payload CMS Localization** - For content localization in the database
2. **next-intl** - For frontend routing and UI translations

## Payload CMS Localization

### Configuration

```typescript
// payload.config.ts
import { buildConfig } from 'payload'

export default buildConfig({
  // ... other config
  localization: {
    locales: [
      {
        label: 'Hungarian',
        code: 'hu',
      },
      {
        label: 'English',
        code: 'en',
      },
    ],
    defaultLocale: 'hu',
    fallback: true, // Fall back to default locale if translation missing
  },
})
```

### Localized Fields

Mark fields as `localized: true` to store separate values per locale:

```typescript
export const Posts: CollectionConfig = {
  slug: 'posts',
  fields: [
    {
      name: 'title',
      type: 'text',
      required: true,
      localized: true, // Stored separately per locale
    },
    {
      name: 'content',
      type: 'richText',
      localized: true,
    },
    {
      name: 'slug',
      type: 'text',
      // NOT localized - same slug across all locales
    },
  ],
}
```

### Localized Tabs

Entire tabs can be localized:

```typescript
{
  type: 'tabs',
  tabs: [
    {
      name: 'meta',
      label: 'SEO',
      localized: true, // All fields in this tab are localized
      fields: [
        { name: 'title', type: 'text' },
        { name: 'description', type: 'textarea' },
      ],
    },
  ],
}
```

### Localized Blocks

```typescript
{
  name: 'layout',
  type: 'blocks',
  blocks: [CallToAction, Content, MediaBlock],
  localized: true, // Different block arrangements per locale
}
```

## Querying Localized Content

### Local API

```typescript
import { getPayload } from 'payload'
import config from '@payload-config'

// Fetch content in specific locale
const posts = await payload.find({
  collection: 'posts',
  locale: 'en', // Specify locale
  draft: false,
})

// Fetch all locales at once
const post = await payload.findByID({
  collection: 'posts',
  id: '123',
  locale: 'all', // Returns all localized versions
})

// Globals with locale
const header = await payload.findGlobal({
  slug: 'header',
  locale: 'hu',
})
```

### Server Components Pattern

```typescript
import { getLocale } from '@/utilities/getLocale'

export async function Header() {
  const locale = await getLocale()
  const headerData = await getCachedGlobal('header', 1, locale)()

  return <HeaderClient data={headerData} />
}
```

### Utility: getLocale

```typescript
// src/utilities/getLocale.ts
import { Locale } from '@/types'
import { getLocale as nextIntlGetLocale } from 'next-intl/server'

export const getLocale = async (): Promise<Locale> => {
  const loc = await nextIntlGetLocale()
  return loc as Locale
}
```

### Utility: getCachedGlobal

```typescript
// src/utilities/getGlobals.ts
import { unstable_cache } from 'next/cache'
import { Locale } from '@/types'

export const getCachedGlobal = (slug: Global, depth = 0, locale: Locale) =>
  unstable_cache(
    async () => getGlobal(slug, depth, locale),
    [slug, depth, locale ?? ''],
    {
      tags: [locale ? `global_${slug}_${locale}` : `global_${slug}`],
    },
  )
```

## next-intl Frontend Integration

### Project Structure

```
src/
├── i18n/
│   ├── routing.ts      # Route configuration
│   ├── request.ts      # Request config for server
│   └── navigation.ts   # Navigation helpers
├── messages/
│   ├── en.json         # English UI translations
│   └── hu.json         # Hungarian UI translations
└── app/
    └── (frontend)/
        └── [locale]/   # Locale dynamic segment
            └── ...
```

### Routing Configuration

```typescript
// src/i18n/routing.ts
import { defineRouting } from 'next-intl/routing'

export const routing = defineRouting({
  locales: ['hu', 'en'],
  defaultLocale: 'hu',
  localePrefix: 'as-needed', // Only prefix non-default locales
  localeDetection: false,
})
```

### Request Configuration

```typescript
// src/i18n/request.ts
import { getRequestConfig } from 'next-intl/server'
import { hasLocale } from 'next-intl'
import { routing } from './routing'

export default getRequestConfig(async ({ requestLocale }) => {
  const requested = await requestLocale
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  }
})
```

### Navigation Helpers

```typescript
// src/i18n/navigation.ts
import { createNavigation } from 'next-intl/navigation'
import { routing } from './routing'

// Use these instead of next/link and next/navigation
export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing)
```

### Middleware Setup

```typescript
// src/middleware.ts
import createMiddleware from 'next-intl/middleware'
import { routing } from '@/i18n/routing'

export default createMiddleware(routing)

export const config = {
  // Skip Payload admin, API routes, and static files
  matcher: ['/((?!api|_next|_vercel|admin|.*\\..*).*)',],
}
```

### Next.js Config

```javascript
// next.config.js
import { withPayload } from '@payloadcms/next/withPayload'
import createNextIntlPlugin from 'next-intl/plugin'

const withNextIntl = createNextIntlPlugin()

export default withNextIntl(withPayload(nextConfig))
```

## Layout Setup

### Root Layout with Locale

```tsx
// src/app/(frontend)/[locale]/layout.tsx
import { hasLocale } from 'next-intl'
import { setRequestLocale } from 'next-intl/server'
import { routing } from '@/i18n/routing'
import { notFound } from 'next/navigation'

export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }))
}

interface Props {
  children: React.ReactNode
  params: Promise<{ locale: string }>
}

export default async function RootLayout({ children, params }: Props) {
  const { locale } = await params

  if (!hasLocale(routing.locales, locale)) {
    notFound()
  }

  setRequestLocale(locale)

  return (
    <html lang={locale}>
      <body>
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  )
}
```

### Provider Setup

```tsx
// src/providers/index.tsx
import { NextIntlClientProvider } from 'next-intl'

export const Providers: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <NextIntlClientProvider>
      {children}
    </NextIntlClientProvider>
  )
}
```

## Using Localized Links

### Import from i18n/navigation

```tsx
// ❌ DON'T use next/link directly
import Link from 'next/link'

// ✅ USE the i18n-aware Link
import { Link } from '@/i18n/navigation'

export function Nav() {
  return (
    <nav>
      {/* Automatically prefixes with locale when needed */}
      <Link href="/posts">Posts</Link>
      <Link href="/search">Search</Link>
    </nav>
  )
}
```

### CMSLink Component Pattern

```tsx
// src/components/Link/index.tsx
import { Link } from '@/i18n/navigation'

export const CMSLink: React.FC<CMSLinkType> = (props) => {
  const { reference, url, type } = props

  const href =
    type === 'reference' && typeof reference?.value === 'object'
      ? `${reference?.relationTo !== 'pages' ? `/${reference?.relationTo}` : ''}/${reference.value.slug}`
      : url

  // Use i18n-aware Link for internal routes
  return <Link href={href}>{children}</Link>
}
```

## Page Components Pattern

```tsx
// src/app/(frontend)/[locale]/[slug]/page.tsx
import { getLocale } from '@/utilities/getLocale'
import { cache } from 'react'

const queryPageBySlug = cache(async ({ slug }: { slug: string }) => {
  const locale = await getLocale()
  const payload = await getPayload({ config: configPromise })

  const result = await payload.find({
    locale, // Pass current locale
    collection: 'pages',
    where: { slug: { equals: slug } },
  })

  return result.docs?.[0] || null
})
```

## Admin Panel Live Preview

```typescript
// Collection config with locale-aware preview
export const Pages: CollectionConfig = {
  slug: 'pages',
  admin: {
    livePreview: {
      url: ({ data, req, locale }) =>
        generatePreviewPath({
          slug: data?.slug,
          collection: 'pages',
          req,
          locale: locale.code as Locale,
        }),
    },
    preview: (data, { req, locale }) =>
      generatePreviewPath({
        slug: data?.slug as string,
        collection: 'pages',
        req,
        locale: locale as Locale,
      }),
  },
}
```

### Preview Path Generator

```typescript
// src/utilities/generatePreviewPath.ts
import { Locale } from '@/types'

export const generatePreviewPath = ({ collection, slug, locale }: Props) => {
  const encodedParams = new URLSearchParams({
    slug: encodeURIComponent(slug),
    collection,
    path: `${collectionPrefixMap[collection]}/${slug}`,
    previewSecret: process.env.PREVIEW_SECRET || '',
    locale: locale || 'hu',
  })

  return `/next/preview?${encodedParams.toString()}`
}
```

## Sitemap Generation with Locales

```typescript
// src/app/(sitemaps)/pages-sitemap.xml/route.ts
import { routing } from '@/i18n/routing'

const getPagesSitemap = unstable_cache(async () => {
  const { locales, defaultLocale } = routing

  // Build hreflang alternates for SEO
  const buildAlternateRefs = (path: string) => {
    const alternateRefs = locales.map((locale) => {
      const localePrefix = locale === defaultLocale ? '' : `/${locale}`
      return {
        href: `${SITE_URL}${localePrefix}${path}`,
        hreflang: locale,
      }
    })

    // Add x-default pointing to default locale
    alternateRefs.push({
      href: `${SITE_URL}${path}`,
      hreflang: 'x-default',
    })

    return alternateRefs
  }

  // Fetch content for all locales
  const postsPerLocale = await Promise.all(
    locales.map(async (locale) => {
      const results = await payload.find({
        collection: 'posts',
        locale,
        where: { _status: { equals: 'published' } },
      })
      return { locale, docs: results.docs }
    })
  )

  // ... build sitemap with alternates
})
```

## Type Safety

### Locale Type from Payload

```typescript
// src/types.ts
import { Config } from '@/payload-types'

// Type-safe locale from generated types
export type Locale = Config['locale']
```

## Best Practices

1. **Keep routing config in sync** - Ensure `routing.ts` locales match `payload.config.ts` localization
2. **Use i18n/navigation Link** - Always import `Link` from `@/i18n/navigation` for frontend
3. **Pass locale to all queries** - Always include `locale` in `payload.find()` and `payload.findGlobal()`
4. **Cache with locale tag** - Include locale in cache tags for proper invalidation
5. **Validate locale in layouts** - Use `hasLocale()` to validate incoming locale params
6. **Set request locale** - Call `setRequestLocale(locale)` in layouts for static generation

## Common Gotchas

1. **Missing locale in queries** - Forgetting `locale` param returns default locale content
2. **Using next/link directly** - Bypasses locale prefixing, breaks navigation
3. **Middleware matcher** - Must exclude `/admin` and `/api` paths from i18n middleware
4. **Cache invalidation** - Must include locale in cache tags for proper revalidation
5. **Static params** - Must generate params for all locales in `generateStaticParams`

